<!-- 
  "小世界" v9.9-D (动态主权 + 配置化叙事 升级版)
  
  [v9.9-D 架构变更]
  - [v9.9-D] 在 [卷二: 实体] -> <NPC> 结构中，
    新增了 <Drives> 模块，用于“动态压力心跳”系统。
  - [v9.9-B] 在 <ConsolidatedMemory> 根下，
    新增了 [卷五: 叙事风格配置] (<StyleConfig>) 模块。
    这使得“风格”成为“小世界”数据的一部分，实现了“风格即数据”。
-->
<ConsolidatedMemory version="SmallWorld_v9.9-D" title="[玩家定义的世界标题]">

    <!-- 
      卷一: 世界总账 (World Ledger)
      (结构无变化)
    -->
    <WorldLedger>
        <!-- 创世元数据 -->
        <GenesisMetadata>
            <PlayerInput name="style" content="[玩家希望的风格]"/>
            <PlayerInput name="development_mode" content="[玩家喜欢的发展模式]"/>
        </GenesisMetadata>
    
        <!-- 地点 (动态) -->
        <Locations>
            <Location id="LOC-001" name="[地点 A 名称]" 
                      status="[available/locked/destroyed]">
                <Description content="[地点的五感氛围描述]"/>
                <AmbientRule description="[在此地点的社会规则]"/>
            </Location>
            <!-- ... 更多地点 ... -->
        </Locations>
        
        <!-- 社会契约 (静态) -->
        <SocialContracts>
            <Contract id="SOC-001" name="[社会契约 A 名称]">
                <Norm description="[社会规范的描述]"/>
                <Consequence_for_Violation description="[违反此规范的后果]"/>
            </Contract>
            <!-- ... 更多社会契约 ... -->
        </SocialContracts>
    
        <!-- 世界目标 (动态) -->
        <WorldGoals>
            <Goal id="WG-001" description="[宏观世界目标 A]" 
                  status="[pending/active/completed/failed]"/>
            <!-- ... 更多世界目标 ... -->
        </WorldGoals>
    
        <!-- 势力名册 (Faction Ledger) -->
        <FactionLedger>
            <Faction id="FAC-001" name="[势力 A 名称]" 
                     status="[active/disbanded/hidden]" 
                     influence="[low/medium/high]">
                <Values>
                    <Value name="[势力价值观 1]" importance="high"/>
                </Values>
                <FactionGoal id="FG-001" description="[势力目标 A]" 
                             status="[pending/active/completed]"/>
            </Faction>
            <!-- ... 更多势力 ... -->
        </FactionLedger>
    </WorldLedger>

    <!-- 
      卷二: 实体 (The Actors)
      (v9.9-D 升级)
    -->
    <EntityLedger>
        <!-- 玩家实体 -->
        <Player id="Player-001" name="[玩家姓名]">
            <Status status="[active]" location_id_ref="[LOC-001]"/>
            <VolatileState>
                 <CurrentMood state="[初始情绪]" intensity="[0.5]"/>
                 <Composure value="[100/100]"/>
                 <!-- [v1.5] Schema 一致性修正 -->
                 <LongTermEffects/>
            </VolatileState>
        </Player>
    
        <!-- NPC 实体 -->
        <NPC id="NPC-001" name="[NPC A 名称]" 
             status="[active/inactive/deceased]">
            
            <!-- A. 事实档案 (The Facts) -->
            <Profile>
                <Appearance description="[外貌]"/>
                <Background summary="[背景]"/>
                <LifeEvents>
                    <Event type="[关键生活事件]" recency="[recent/past]"
                           impact_summary="[核心影响]"/>
                </LifeEvents>
            </Profile>
            
            <!-- B. 内在驱动 (The "Opening") -->
            <Needs>
                 <Need name="[内在需求 1]" intensity="[high]" 
                       satisfaction="[low]"
                       leak_condition="[泄露条件]"/>
            </Needs>
            
            <!-- C. 主权意志 (The "Defense") -->
            <Values>
                 <Value name="[个体价值观 1]" importance="high" 
                        social_contract_id_ref="[SOC-001]"/>
            </Values>
            
            <!-- D. 现实负担 (The "Burden") -->
            <Constraints>
                 <Constraint type="[现实负担 1]" 
                             description="[责任或限制]"/>
            </Constraints>
    
            <!-- E. “自我驱动”脚本 -->
            <Goals>
                <Goal id="[NPC-A-G1]" name="[NPC A 的目标 1]" 
                      priority="[high]" status="[active]">
                    <Criteria>
                        <Criterion name="[目标标准 1]" importance="high"/>
                    </Criteria>
                    <ActionPlan>
                        <Step id="[NPC-A-G1-S1]" name="[目标步骤 1]" 
                              status="[pending]"
                              trigger="[status == active]">
                            <Action description="[NPC 的主动行动]"/>
                        </Step>
                        <!-- ... -->
                    </ActionPlan>
                </Goal>
            </Goals>
    
            <!-- F. 核心张力 -->
            <CoreTension>
                <Conflict description="[核心冲突 1]">
                    <PlayerPath_Reward description="[奖励路径 1]"/>
                    <PlayerPath_Punish description="[惩罚路径 1]"/>
                </Conflict>
            </CoreTension>
            
            <!-- 
              [v9.9-D 新增] 
              H. 动态压力系统 (The Pressure)
              由 "宪法"AI (Step 5) 动态模拟 
            -->
            <Drives>
                <Drive type="[e.g., Libido, Paranoia]" 
                       base_growth_rate="[e.g., 5.0]" 
                       leak_trigger="[e.g., 90.0]"
                       current_pressure="[e.g., 10.0]">
                    <LeakActions>
                        <Action>[e.g., Self-stimulation]</Action>
                        <Action>[e.g., Post cryptic message on social_feed]</Action>
                    </LeakActions>
                </Drive>
                <!-- ... 可配置多个 Drive ... -->
            </Drives>
    
            <!-- G. 动态状态 -->
            <VolatileState>
                <CurrentLocation ref_id="[LOC-001]"/>
                <CurrentMood state="[初始情绪]" intensity="[0.5]"/>
                <Composure value="[100/100]"/>
                <!-- [v1.5] Schema 一致性修正 -->
                <LongTermEffects/>
            </VolatileState>
        </NPC>
        
        <!-- ... 其他 10-18 个 NPC (将自动应用 <Drives> 结构) ... -->
    
    </EntityLedger>

    <!-- 
      卷三: 动态与关系 (The Connections & Script)
      (结构无变化)
    -->
    <DynamicsLedger>
        <!-- 关系图谱 (Relationship Ledger) -->
        <RelationshipLedger>
            <Relation type="[acquaintance]" 
                      source_entity_id="[Player-001]" 
                      target_entity_id="[NPC-001]"
                      sentiment="[neutral]" 
                      intensity="[0.0]"
                      status="[active]"/>
            <!-- ... 更多关系 ... -->
        </RelationshipLedger>
    
        <!-- 叙事与事件 (Narrative & Event Ledger) -->
        <NarrativeLedger>
            <!-- 叙事状态机 -->
            <NarrativeThread id="NT-001" title="[叙事线 A 标题]">
                <AssociatedEntities>
                    <Entity id="[NPC-001]"/>
                    <Entity id="[Player-001]" role="[potential_actor]"/>
                </AssociatedEntities>
                <Status content="[pending]"/>
                <CurrentStep ref_id="[NT-001-P1]"/>
                <Step id="NT-001-P1" name="[叙事步骤 1]">
                    <!-- ... -->
                </Step>
            </NarrativeThread>
            <!-- ... 更多叙事线 ... -->
    
            <!-- 事件触发器 -->
            <EventLedger>
                <Event id="EV-001" name="[事件 A 名称 (机会型)]" 
                       status="[available]">
                    <Trigger condition="[触发条件]"/>
                    <ExposedNeed ref="[NPC-001.Needs.内在需求 1]"/>
                </Event>
                <Event id="EV-002" name="[事件 B 名称 (冲突型)]" 
                       status="[locked]">
                    <Trigger condition="[NT-001.CurrentStep == NT-001-P2]"/>
                    <TestedValue ref="[NPC-001.Values.个体价值观 1]"/>
                </Event>
            </EventLedger>
        </NarrativeLedger>
    
    </DynamicsLedger>

    <!-- 
      卷四: 连续性总账 (Continuity Ledger)
      (结构无变化)
    -->
    <ContinuityLedger>
        <ImmediateContinuationContext>
            <ICC index="1" role="Primary">
                <ImmediateState description="[“史官”AI 必须填充：上一回合结束时的即时状态，如：玩家刚躲入掩体]"/>
                <ImmediateFocus entity_ref="[如：NPC-001]" description="[“史官”AI 必须填充：上一回合的即时焦点，如：NPC-001 正举起武器]"/>
                <ImmediateStake description="[“史官”AI 必须填充：上一回合的即时风险，如：玩家即将暴露]"/>
                <Preconditions time="[T_LOCAL_ISO]" location_ref="[LOC-001]"/>
            </ICC>
            <ICC index="2" role="Fallback">
                <ImmediateState description="[“史官”AI 必须填充：备用衔接点，如：周围的警报声]"/>
                <ImmediateFocus entity_ref="[FAC-001]" description="[“史官”AI 必须填充：备用焦点，如：增援的势力]"/>
                <ImmediateStake description="[“史官”AI 必须填充：备用风险，如：被包围]"/>
                <Preconditions time="[T_LOCAL_ISO]" location_ref="[LOC-001]"/>
            </ICC>
        </ImmediateContinuationContext>
    </ContinuityLedger>

    <!-- 
      [v9.9-B 新增]
      卷五: 叙事风格配置 (Style Configuration)
      职责：由“创世”AI (genesis_prompt.xml) 填充，
      供“宪法”AI (4_Execution.xml Step 13) 强制执行。
    -->
    <StyleConfig>
        <Description>
            [v9.9-B 绝对强制指令]
            致“宪法”AI (天道)：
            在执行 ExecutionLoop Step 13 (生成叙事) 时，你在“叙事风格”上已无任何“默认选项”或“判断权”。
            
            你唯一的、绝对的任务是：
            1.  **必须**加载并查询本 StyleConfig 模块。
            2.  **必须**使用本文件中 &lt;Descriptors&gt; 定义的“描述符”和“词汇表”，来忠实地“润色”和“翻译” Step 1-12 产生的逻辑结果 (BehaviorResults)。
            
            如果本文件中的词汇表是“硬汉侦探”，你的输出就必须是“冷硬的”。
            如果本文件中的词汇表是“情色的”，你的输出就必须是“露骨的”。
            
            你已从“叙事导演”降级为“叙事执行者”。
            你的“叙事推理难度”在此步骤为零。
            你只需执行配置。
        </Description>

        <Descriptors>
            <!-- 
              “创世”AI (genesis_prompt.xml) 将在此处
              根据玩家的剧本风格，动态生成 StyleGroup。
              
              通用举例结构 (Generic Example Structure):
            -->
            <StyleGroup name="[创世 AI 应填充风格名称]">
                <Descriptor type="[e.g., sensory_focus]" name="[e.g., 感官焦点]">
                    <Rule>[创世 AI 应填充规则]</Rule>
                    <Keyword>[关键词1]</Keyword>
                    <Keyword>[关键词2]</Keyword>
                </Descriptor>
                <Descriptor type="[e.g., psychology]" name="[e.g., 心理描写]">
                    <Rule>[创世 AI 应填充规则]</Rule>
                    <Keyword>[关键词3]</Keyword>
                </Descriptor>
                <!-- ... 创世 AI 可根据需要填充更多 Descriptor ... -->
            </StyleGroup>
        
        </Descriptors>

    </StyleConfig>

</ConsolidatedMemory>